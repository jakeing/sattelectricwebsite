<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Worker Roles & Rates - SATT Dashboard</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <style>
    
    .navbar-brand img { height: 40px; }
    /* Navbar - Dark Theme */
    .navbar { 
      background-color: #000000 !important;
      border-bottom: 1px solid #333333;
    }

    /* Navbar text colors */
    .navbar-light .navbar-brand,
    .navbar-light .navbar-nav .nav-link {
      color: #ffffff !important;
    }

    .navbar-light .navbar-nav .nav-link:hover {
      color: #66b3ff !important;
    }

    .navbar-light .navbar-toggler {
      border-color: #333333;
    }

    .navbar-light .navbar-toggler-icon {
      background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3e%3cpath stroke='rgba%28255, 255, 255, 0.75%29' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e");
    }

    /* Dropdown menus - Dark theme */
    .dropdown-menu { 
      border-radius: .35rem;
      background-color: #1a1a1a;
      border: 1px solid #333333;
    }

    .dropdown-item {
      color: #ffffff;
    }

    .dropdown-item:hover {
      background-color: #333333;
      color: #66b3ff;
    }

    /* Search form styling for dark navbar */
    .navbar .form-control {
      background-color: #2a2a2a;
      border-color: #444444;
      color: #ffffff;
    }

    .navbar .form-control:focus {
      background-color: #333333;
      border-color: #007bff;
      color: #ffffff;
      box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
    }

    .navbar .form-control::placeholder {
      color: #aaaaaa;
    }

    .navbar .btn-outline-primary {
      color: #66b3ff;
      border-color: #66b3ff;
    }

    .navbar .btn-outline-primary:hover {
      background-color: #66b3ff;
      border-color: #66b3ff;
      color: #000000;
    }
    .container-fluid { max-width: 100%; padding: 0 0.5rem; }
    
    .card {
      border-radius: .35rem;
      box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
      margin-bottom: 1.5rem;
    }
    
    .card-header {
      background-color: #f8f9fa;
      padding: 0.75rem 1.25rem;
      border-bottom: 1px solid rgba(0, 0, 0, 0.125);
    }
    
    .admin-warning {
      background: linear-gradient(45deg, #dc3545, #c82333);
      color: white;
      padding: 1rem 1.25rem;
      border-radius: .5rem;
      margin-bottom: 1.5rem;
      text-align: center;
      font-weight: bold;
      box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3);
    }
    
    .role-item {
      background: white;
      border: 1px solid #e9ecef;
      border-radius: .5rem;
      margin-bottom: 1rem;
      padding: 1.25rem;
      transition: all 0.2s;
    }
    
    .role-item:hover {
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      transform: translateY(-2px);
    }
    
    .role-name {
      font-weight: bold;
      font-size: 1.25rem;
      color: #495057;
      margin-bottom: 0.5rem;
    }
    
    .role-rate {
      font-size: 1.1rem;
      color: #28a745;
      font-weight: 600;
    }
    
    .add-role-form {
      background: #f8f9fa;
      padding: 1.5rem;
      border-radius: .5rem;
      margin-bottom: 2rem;
    }
    
    .btn-success {
      background: linear-gradient(45deg, #28a745, #20c997);
      border: none;
    }
    
    .btn-danger {
      background: linear-gradient(45deg, #dc3545, #c82333);
      border: none;
    }
    
    .empty-state {
      text-align: center;
      padding: 3rem 1rem;
      color: #6c757d;
      font-style: italic;
    }
    
    .form-control:focus {
      border-color: #80bdff;
      box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
    }
    
    .alert {
      border-radius: .5rem;
      margin-bottom: 1.5rem;
    }
    
    .alert-success {
      background-color: #d4edda;
      border-color: #c3e6cb;
      color: #155724;
    }
    
    .alert-danger {
      background-color: #f8d7da;
      border-color: #f5c6cb;
      color: #721c24;
    }
  </style>
</head>
<body>

  <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm sticky-top py-2">
    <a class="navbar-brand d-flex align-items-center" href="{{ url_for('index') }}">
      <img src="{{ url_for('static', filename='SATT logo.png') }}" alt="SATT Logo" class="mr-2">
      <span class="h5 mb-0 d-none d-sm-inline">SATT Dashboard</span>
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav mr-auto">
        <!-- Work Orders -->
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="woDropdown" role="button" data-toggle="dropdown">Work Orders</a>
          <div class="dropdown-menu" aria-labelledby="woDropdown">
            <a class="dropdown-item" href="{{ url_for('index') }}">Open</a>
            <a class="dropdown-item" href="{{ url_for('completed_work_orders') }}">Completed</a>
            <a class="dropdown-item" href="{{ url_for('closed_work_orders') }}">Closed</a>
          </div>
        </li>
        <!-- Projects -->
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="projectsDropdown" role="button" data-toggle="dropdown">Projects</a>
          <div class="dropdown-menu" aria-labelledby="projectsDropdown">
            <a class="dropdown-item" href="{{ url_for('projects') }}">All Projects</a>
            <a class="dropdown-item" href="{{ url_for('new_project') }}">New Project</a>
          </div>
        </li>
        <!-- Timesheets -->
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="tsDropdown" role="button" data-toggle="dropdown">Timesheets</a>
          <div class="dropdown-menu" aria-labelledby="tsDropdown">
            <a class="dropdown-item" href="{{ url_for('new_timesheet') }}">New Entry</a>
            <a class="dropdown-item" href="{{ url_for('select_weekly_timesheet') }}">Select Weekly</a>
            <a class="dropdown-item" href="/workorder/reassign_entries">Reassign Entries</a>
          </div>
        </li>
        <!-- Actions -->
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="actionsDropdown" role="button" data-toggle="dropdown">Actions</a>
          <div class="dropdown-menu" aria-labelledby="actionsDropdown">
            <a class="dropdown-item" href="{{ url_for('new_work_order') }}">Create WO</a>
            <a class="dropdown-item" href="{{ url_for('import_excel') }}">Import Excel</a>
            <a class="dropdown-item" href="{{ url_for('export_excel') }}">Export Excel</a>
          </div>
        </li>
        <!-- Admin -->
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="adminDropdown" role="button" data-toggle="dropdown">Admin</a>
          <div class="dropdown-menu" aria-labelledby="adminDropdown">
            <a class="dropdown-item" href="{{ url_for('admin_dashboard') }}">Dashboard</a>
            <a class="dropdown-item" href="{{ url_for('admin_users') }}">User Mgmt</a>
            <a class="dropdown-item" href="{{ url_for('admin_roles') }}">Worker Roles</a>
            <a class="dropdown-item" href="{{ url_for('admin_import_time_entries') }}">Import Time</a>
            <a class="dropdown-item" href="{{ url_for('admin_email_settings') }}">Notifications</a>
            <a class="dropdown-item" href="{{ url_for('admin_edit_rate') }}">Roles & Rates</a>
            <a class="dropdown-item" href="{{ url_for('accounting') }}">Accounting</a>
      </a>
          </div>
        </li>
      </ul>
      <ul class="navbar-nav ml-md-3 mt-2 mt-md-0">
        <li class="nav-item"><a class="nav-link" href="{{ url_for('logout') }}">Logout</a></li>
      </ul>
    </div>
  </nav>

  <div class="container-fluid mt-4">
    <div class="row">
      <div class="col-lg-8 mx-auto">
        
        <div class="admin-warning">
          ðŸ”’ ADMIN ONLY - Worker Roles & Rates Management
        </div>
        
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h1 class="h2 mb-0">Worker Roles & Rates</h1>
          <a href="{{ url_for('admin_dashboard') }}" class="btn btn-outline-secondary">Back to Admin</a>
        </div>

        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            {% for category, message in messages %}
              <div class="alert alert-{{ 'danger' if category == 'error' else 'success' }} alert-dismissible fade show">
                {{ message }}
                <button type="button" class="close" data-dismiss="alert">&times;</button>
              </div>
            {% endfor %}
          {% endif %}
        {% endwith %}

        <!-- Add New Role Form -->
        <div class="card">
          <div class="card-header">
            <h5 class="mb-0">Add New Worker Role</h5>
          </div>
          <div class="card-body">
            <form method="POST" action="{{ url_for('add_worker_role') }}" class="add-role-form">
              <div class="row">
                <div class="col-md-6">
                  <div class="form-group">
                    <label for="roleName"><strong>Role Name:</strong></label>
                    <input type="text" class="form-control" id="roleName" name="name" placeholder="e.g., Working Foreman" required>
                    <small class="form-text text-muted">Enter a descriptive name for this worker role</small>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-group">
                    <label for="hourlyRate"><strong>Hourly Rate ($):</strong></label>
                    <input type="number" class="form-control" id="hourlyRate" name="hourly_rate" step="0.01" min="0.01" placeholder="165.00" required>
                    <small class="form-text text-muted">Rate per hour in dollars</small>
                  </div>
                </div>
                <div class="col-md-2 d-flex align-items-end">
                  <div class="form-group mb-0 w-100">
                    <button type="submit" class="btn btn-success btn-block">Add Role</button>
                  </div>
                </div>
              </div>
            </form>
          </div>
        </div>

        <!-- Current Roles -->
        <div class="card">
          <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0">Current Worker Roles</h5>
            <small class="text-muted">{{ roles|length }} role(s) configured</small>
          </div>
          <div class="card-body">
            {% if roles %}
              {% for role in roles %}
                <div class="role-item">
                  <div class="d-flex justify-content-between align-items-center">
                    <div class="flex-grow-1">
                      <div class="role-name">{{ role.name }}</div>
                      <div class="role-rate">${{ "%.2f"|format(role.hourly_rate) }}/hour</div>
                      <small class="text-muted">
                        Created: {{ role.created_at.strftime('%Y-%m-%d') if role.created_at else 'N/A' }}
                      </small>
                    </div>
                    <div class="ml-3">
                      <form method="POST" action="{{ url_for('delete_worker_role', role_id=role.id) }}" style="display: inline;" 
                            onsubmit="return confirm('Are you sure you want to remove the role: {{ role.name }}?\n\nThis action cannot be undone.')">
                        <button type="submit" class="btn btn-danger">
                          <i class="fas fa-trash-alt"></i> Remove
                        </button>
                      </form>
                    </div>
                  </div>
                </div>
              {% endfor %}
            {% else %}
              <div class="empty-state">
                <div class="mb-3">
                  <i class="fas fa-users fa-3x text-muted"></i>
                </div>
                <h5 class="text-muted">No Worker Roles Created Yet</h5>
                <p class="text-muted">Add your first worker role using the form above to get started.</p>
                <div class="mt-3">
                  <small class="text-muted">
                    <strong>Suggested roles:</strong> Working Foreman ($165/hr), Non-Working Foreman ($160/hr), 
                    Journeyman ($140/hr), Apprentice 5 ($130/hr)
                  </small>
                </div>
              </div>
            {% endif %}
          </div>
        </div>

        <!-- Quick Reference Card -->
        <div class="card">
          <div class="card-header">
            <h5 class="mb-0">ðŸ’¡ Quick Reference</h5>
          </div>
          <div class="card-body">
            <div class="row">
              <div class="col-md-6">
                <h6 class="font-weight-bold">Worker Role Features:</h6>
                <ul class="small">
                  <li>Assign hourly rates to different skill levels</li>
                  <li>Track labor costs by role type</li>
                  <li>Use in work order assignments</li>
                  <li>Generate cost reports by role</li>
                </ul>
              </div>
              <div class="col-md-6">
                <h6 class="font-weight-bold">Admin Controls:</h6>
                <ul class="small">
                  <li>Only admins can view/edit rates</li>
                  <li>Regular users see role names only</li>
                  <li>Rates are protected in work orders</li>
                  <li>Historical rate tracking available</li>
                </ul>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://kit.fontawesome.com/your-font-awesome-kit.js" crossorigin="anonymous"></script>
  
  <script>
    // Auto-focus on role name input when page loads
    document.addEventListener('DOMContentLoaded', function() {
      const roleNameInput = document.getElementById('roleName');
      if (roleNameInput) {
        roleNameInput.focus();
      }
    });

    // Form validation
    document.querySelector('form[action="{{ url_for("add_worker_role") }}"]').addEventListener('submit', function(e) {
      const nameInput = document.getElementById('roleName');
      const rateInput = document.getElementById('hourlyRate');
      
      const name = nameInput.value.trim();
      const rate = parseFloat(rateInput.value);
      
      if (!name) {
        e.preventDefault();
        alert('Please enter a role name.');
        nameInput.focus();
        return;
      }
      
      if (!rate || rate <= 0) {
        e.preventDefault();
        alert('Please enter a valid hourly rate greater than $0.00.');
        rateInput.focus();
        return;
      }
      
      if (rate > 1000) {
        if (!confirm('The hourly rate is quite high ($' + rate.toFixed(2) + '/hr). Are you sure this is correct?')) {
          e.preventDefault();
          rateInput.focus();
          return;
        }
      }
    });

    // Auto-dismiss alerts after 5 seconds
    setTimeout(function() {
      const alerts = document.querySelectorAll('.alert:not(.alert-permanent)');
      alerts.forEach(function(alert) {
        if (alert.classList.contains('show')) {
          alert.classList.remove('show');
          alert.classList.add('fade');
          setTimeout(function() {
            if (alert.parentNode) {
              alert.parentNode.removeChild(alert);
            }
          }, 500);
        }
      });
    }, 5000);

    // Enter key support for form
    document.getElementById('roleName').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        e.preventDefault();
        document.getElementById('hourlyRate').focus();
      }
    });
    
    document.getElementById('hourlyRate').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        e.preventDefault();
        this.form.submit();
      }
    });

    // Format currency input
    document.getElementById('hourlyRate').addEventListener('blur', function() {
      const value = parseFloat(this.value);
      if (!isNaN(value)) {
        this.value = value.toFixed(2);
      }
    });
  </script>
</body>
</html>